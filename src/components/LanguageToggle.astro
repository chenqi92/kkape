---
import { getLangFromUrl, languages } from '@i18n/index';

const lang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;
---

<div class="flex gap-2">
  {Object.entries(languages).map(([key, value]) => {
    const isActive = lang === value;
    let targetPath = currentPath;

    // Handle language switching in URL
    if (lang === 'zh') {
      targetPath = value === 'en' ? `/en${currentPath}` : currentPath;
    } else {
      targetPath = value === 'zh' ? currentPath.replace(/^\/en/, '') : currentPath;
    }

    // Ensure path starts with /
    if (!targetPath.startsWith('/')) {
      targetPath = '/' + targetPath;
    }

    return (
      <a
        href={targetPath}
        class={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${
          isActive
            ? 'bg-primary-600 text-white'
            : 'bg-[rgb(var(--color-bg-secondary))] text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-border))]'
        }`}
      >
        {key.toUpperCase()}
      </a>
    );
  })}
</div>
